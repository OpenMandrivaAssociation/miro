From 42fcd8901056123db73b3923450fdccebebdb22b Mon Sep 17 00:00:00 2001
From: Ben Dean-Kawamura <ben@pculture.org>
Date: Mon, 29 Apr 2013 16:19:11 -0400
Subject: [PATCH] bz19987: don't try to copy data from internal sqlite tables.

---
 tv/lib/storedatabase.py | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/tv/lib/storedatabase.py b/tv/lib/storedatabase.py
index 88d9f2b..f61e0ac 100644
--- a/tv/lib/storedatabase.py
+++ b/tv/lib/storedatabase.py
@@ -575,8 +575,9 @@ def should_recreate_table(table_name):
                 table_name.endswith("fts_segments") or
                 table_name.endswith("fts_stat") or
                 table_name.endswith("fts_docsize") or
-                table_name.endswith("fts_segdir")):
-                # these tables are auto-generated by the fts4 code
+                table_name.endswith("fts_segdir") or
+                table_name.startswith("sqlite_")):
+                # these tables are auto-generated by sqlite
                 return False
             return True
         table_info = [(table, sql) for (table, sql) in self.cursor.fetchall()
@@ -590,7 +591,7 @@ def should_recreate_table(table_name):
                                 "WHERE type='index' AND tbl_name=?",
                                 (table,))
             for index, sql in self.cursor.fetchall():
-                if index.startswith('sqlite_autoindex'):
+                if index.startswith('sqlite_'):
                     continue
                 sql = sql.replace("INDEX %s" % index,
                                   "INDEX newdb.%s" % index)
-- 
1.8.5.1

